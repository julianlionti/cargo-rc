generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum CargoStatus {
  AVAILABLE
  PENDING // When a driver selects the cargo, awaiting company approval
  PICKED_UP
  IN_TRANSIT
  DELIVERED
  CANCELLED
}

enum CargoSize {
  SMALL
  MEDIUM
  LARGE
}

enum CargoUrgency {
  LOW
  MEDIUM
  HIGH
}

model Cargo {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  origin      String
  destination String
  weight      Float
  reward      Float // Reward for completing the delivery
  size        CargoSize // Enum for size (small, medium, large)
  urgency     CargoUrgency // Enum for urgency (low, medium, high)

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?  @db.ObjectId

  originLat      Float // Latitude for the origin location
  originLng      Float // Longitude for the origin location
  destinationLat Float // Latitude for the destination location
  destinationLng Float // Longitude for the destination location

  distanceAprox Float @default(0)

  deliveryDateTime DateTime @default(now())

  assignedTo   Driver? @relation("AssignedTo", fields: [assignedToId], references: [id]) // Assigned driver
  assignedToId String? @db.ObjectId

  requestedBy   Driver? @relation("RequestedBy", fields: [requestedById], references: [id]) // Driver requesting cargo
  requestedById String? @db.ObjectId

  requestedAt DateTime? // Timestamp when the cargo was requested
  approvedAt  DateTime? // Timestamp when the request was approved

  status  CargoStatus // Enum for cargo status
  Payment Payment[] // Payment records related to the cargo
}

model Company {
  id     String  @id @default(auto()) @map("_id") @db.ObjectId
  name   String
  email  String  @unique
  cargos Cargo[] // Cargos listed by the company
  users  User[] // Users associated with the company
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  email     String   @unique
  uid       String   @unique
  role      UserRole // Enum for the user's role
  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?  @db.ObjectId

  Payment      Payment[]
  Notification Notification[]
  Driver       Driver[] // If the user is also a driver, link to the Driver model
}

enum UserRole {
  ADMIN
  COMPANY_USER // General user role for companies
  COMPANY_ADMIN // Admin role for companies
  DRIVER
}

model Driver {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])
  userId String @unique @db.ObjectId

  licenseNumber  String // Driver's license number
  vehicleDetails String? // Information about the driver's vehicle
  certifications String[] // Any certifications the driver holds

  assignedCargos  Cargo[] @relation("AssignedTo") // Cargos assigned to the driver
  requestedCargos Cargo[] @relation("RequestedBy") // Cargos requested by the driver

  lastKnownLat     Float? // Latitude of the last known location
  lastKnownLng     Float? // Longitude of the last known location
  lastLocationTime DateTime? // Timestamp of the last location update
}

model Payment {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  amount        Float
  status        PaymentStatus
  cargo         Cargo         @relation(fields: [cargoId], references: [id])
  cargoId       String        @db.ObjectId
  initiatedBy   User          @relation(fields: [initiatedById], references: [id])
  initiatedById String        @db.ObjectId
  createdAt     DateTime      @default(now())
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  message   String
  user      User     @relation(fields: [userId], references: [id])
  userId    String   @db.ObjectId
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}
